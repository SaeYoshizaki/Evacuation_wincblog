---
import Layout from "../layouts/Layout.astro";
import HamburgerMenu from "../components/Header/header.astro";

type Post = {
  id: number;
  title: {
    rendered: string;
  };
  content: {
    rendered: string;
  };
  date: string;
};

export async function getStaticPaths() {
  const response = await fetch('http://test.local/wp-json/wp/v2/posts');
  const posts: Post[] = await response.json();

  return posts.map((post) => ({
    params: {
      id: post.id.toString(),
    },
  }));
}

const postId = Astro.params.id;
const response = await fetch(`http://test.local/wp-json/wp/v2/posts/${postId}`);
const post: Post = await response.json();

const postTitle = post.title.rendered;
const postContent = post.content.rendered;
const postDate = post.date;

type Category = {
  id: number;
  name: string;
  description: string;
  slug: string;
};
let postCategory: string[] =[];

// const categoryId = post.categories.length > 0 ? post.categories[0] : null;
// let categoryName = '';

// if (categoryId) {
//   categoryName = await getCategoryName(categoryId);
// }
---

<Layout title={postTitle}>
  <main>
    <div class="without_header">
      <p class="guide"><a>home</a> > <a>blog</a> > <a>Web team</a> > <a>{postTitle}</a></p>
      <p class="slug">{postCategory}</p>
      <div class="Title_box">
        <span></span>
        <h2>{postDate.substring(0,4)}.{postDate.substring(5,7)}.{postDate.substring(8,10)}</h2>
        <h1>{postTitle}</h1>
        <div class="Title_box_background"></div>
      </div>
      <div set:html={postContent}></div>
    </div>
  </main>

  <script>
    const adjustImageSize = () => {
      const images = document.querySelectorAll('img');
      images.forEach((img) => {
        const width = window.innerWidth;
        if (width < 768) {
          img.style.width = '100%';
          img.style.height = 'auto';
        } else {
          img.style.width = '80%';
          img.style.height = 'auto';
        }
        img.style.display = 'block';
        img.style.margin = '0 auto';
      });
    };

    // ページ読み込み時とリサイズ時に画像のサイズを調整
    window.addEventListener('DOMContentLoaded', adjustImageSize);
    window.addEventListener('resize', adjustImageSize);
  </script>
</Layout>

<style>
  main {
    margin: auto;
    max-width: 60ch;
    text-align: center;
  }

  body {
    margin:0;
  }

  .without_header {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .guide {
    text-align: left;
    margin: 0;
    color: #232428;
    font-family: "Zen Kaku Gothic New";
    font-size: 24px;
    font-style: normal;
    font-weight: 300;
    line-height: normal;
  }

  .guide a{
    color: #232428;
    font-family: "Zen Kaku Gothic New";
    font-size: 24px;
    font-style: normal;
    font-weight: 300;
    line-height: normal;
  }

  .Title_box {
    width: 894px;
    height: 162px;
    margin-top: 22px;
    display: flex;
    flex-direction: column;
    text-align: left;
    position: relative;
  }

  .Title_box_background {
    position: absolute;
    background: rgba(169, 238, 222, 0.20);
    filter: blur(14.25px);
    width: 894px;
    height: 162px;
  }

  .Title_box::before {
    content: "";
    position: absolute;
    width: 12px;
    height: 203px;
    background: rgba(58, 214, 178, 0.20);
    top: 43px;
    right: calc(100% + 153px);
  }

  .Title_box span::before {
    content: "";
    position: absolute;
    width: 298px;
    height: 12px;
    background: rgba(58, 214, 178, 0.20);
    top: calc(100% + 34px);
    right: calc(100% - 95px);
  }

  .Title_box::after {
    content: "";
    position: absolute;
    width: 12px;
    height: 203px;
    background: rgba(58, 214, 178, 0.20);
    top: -84px;
    left: calc(100% + 141px);
  }

  .Title_box span::after {
    content: "";
    position: absolute;
    width: 298px;
    height: 12px;
    background: rgba(58, 214, 178, 0.20);
    top: -34px;
    left: calc(100% - 95px);
  }

  h1 {
    color: #232428;
    text-align: center;
    font-family: "Zen Kaku Gothic New";
    font-size: 64px;
    font-style: normal;
    font-weight: 300;
    line-height: normal;
  }

  h2 {
    margin: 0;
    color: #878787;
    font-family: "Zen Kaku Gothic New";
    font-size: 24px;
    font-style: normal;
    font-weight: 300;
    line-height: normal;
    letter-spacing: 4.8px; 
  }

  img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }

  ul {
    padding: 0;
    list-style-type: none;
    text-align: center;
  }

  li {
    margin-bottom: 10px;
  }

  a {
    font-size: 20px;
    color: black;
    text-decoration: none;
    font-weight: 600;
  }

  a:hover {
    background: rgb(179, 179, 239);
  }
</style>
