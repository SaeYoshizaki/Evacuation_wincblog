---
import Layout from "../layouts/Layout.astro";
type Category = {
  id: number;
  name: string;
  description: string;
  slug: string;
};

type Post = {
  id: number;
  title: {
    rendered: string;
  };
  date: string;
  featured_media: number;
  content: {
    rendered: string;
  };
};


const response = await fetch('http://test.local/wp-json/wp/v2/categories');
const categories: Category[] = await response.json();

export async function getStaticPaths() {
  const response = await fetch('http://test.local/wp-json/wp/v2/categories');
  const categories: Category[] = await response.json();

  return categories.map((category) => ({
    params: {
      category: category.slug,
    },
  }));
}

const currentCategory = categories.find(cat => cat.slug === Astro.params.category);

const categoryName = currentCategory ? currentCategory.name : '';
const categoryDescription = currentCategory ? currentCategory.description : '';
const categoryId = currentCategory ? currentCategory.id : null;

let posts: Post[] = [];
let postTitles: string[] = [];
let postIds: number[] = [];
let postDates: string[] = [];


if (categoryId) {
  const postsResponse = await fetch(`http://test.local/wp-json/wp/v2/posts?categories=${categoryId}`);
  posts = await postsResponse.json();

  postTitles = posts.map(post => post.title.rendered);
  postIds = posts.map(post => post.id);
  postDates = posts.map(post => post.date);

}
---

<Layout title="wincblog">
  <main>
    <h1>{categoryName}</h1>

    <div class="carousel">
      <figure>
        <img src="web/picture1.jpg" alt="">
        <img src="web/picture2.jpg" alt="">
        <img src="web/picture3.jpg" alt="">
        <img src="web/picture4.jpg" alt="">
        <img src="web/picture5.jpg" alt="">
      </figure>
    </div>
    <script>
      const carousel = document.querySelector('.carousel figure');
      let currentAngle = 0;
      const rotationStep = 72; // 各画像の回転角度 (360度 / 5枚 = 72度)
      const totalImages = 5; // カルーセルにある画像の枚数
    
      document.addEventListener('click', (e) => {
        const viewportWidth = window.innerWidth;
    
        if (e.clientX < viewportWidth / 2) {
          // 画面の左半分をクリックしたとき
          currentAngle += rotationStep; // 左に回転
        } else {
          // 画面の右半分をクリックしたとき
          currentAngle -= rotationStep; // 右に回転
        }
    
        // 回転を適用し、連続してクリックしても続けて回転するようにする
        carousel.style.transform = `rotateY(${currentAngle}deg)`;
      });
    
    </script>
    
    
    
    {postTitles.length > 0 ? (
      <ul>
        {postTitles.map((postTitle, index) => {
          const year = postDates[index].substring(0, 4);
          const month = postDates[index].substring(5, 7);
          const date = postDates[index].substring(8, 10);
          const postId = postIds[index];
          const content = posts[index].content.rendered.substring(4, 26);
       

          return (
            <li key={index}>
              <div class="blog">
                <div class="picture">
                  <a href={`./${postIds[index]}`}>
                  <img src={`http://test.local/wp-content/uploads/${year}/${month}/${postId}.jpg`} alt={postTitle} class="post-image"/>
                  </a>
                </div>
                <div class="post">
                  <a href={`./${postIds[index]}`} class="title">{postTitle}</a>
                  <p class="date">投稿日: {year}年{month}月{date}日</p>
                  <div class="ex">
                  <p class="explanation">{content}・・・</p>
                  <a href={`./${postIds[index]}`} class="tsuzuki">続きはこちら</a>
                  </div>
                </div>
              </div>
            </li>
          );
        })}
      </ul>
    ) : (
      <p>投稿がありません</p>
    )}
  </main>
</Layout>

<style>
  h1{
    color: #0E3E81;
    font-family: "Zen Kurenaido";
    font-size: 128px;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
  }

  .post-image {
    width: 200px;
    height: 200px;
    flex-shrink: 0;
    object-fit: cover;
  }

  .blog {
    margin-bottom: 20px; 
    display: flex;
    justify-content: center;
    margin: 0 auto;
  }

  main {
    margin:auto;
    max-width: 80%;
    text-align: center;
  }

  ul {
    padding: 0;
    list-style-type: none;
  }

  li {
    margin-bottom: 10px;
  }

  .title {
    color: #232428;
    font-size: 32px;
    font-style: normal;
    font-weight: 300;
    line-height: normal;
    letter-spacing: 6.4px;
    text-decoration: none;
  }

  p{
    color: #232428;
    font-family: "Zen Kaku Gothic New";
    font-size: 16px;
    font-style: normal;
    font-weight: 300;
    line-height: normal;
    letter-spacing: 3.2px;
  }

  a:hover {
    background: rgb(179, 179, 239);
  }
  .post{
    width: 759px;
    height: 200px;
    flex-shrink: 0;
    border: 1px solid #000;
    background: #FFF;
  }
  .picture{
    width: 200px;
    height: 200px;
    flex-shrink: 0;
    border: 1px solid #000;
    background: #FFF;
  }
  .carousel {
  padding: 20px;
  perspective: 500px;
  overflow: hidden;

  display: flex;
  flex-direction: column;
  align-items: center;
}

.carousel > * {
  flex: 0 0 auto;
}

.carousel figure {
  margin: 0;
  width: 400px; 
  transform-style: preserve-3d;
  transition: transform 0.5s;
  transform-origin: 50% 50% -482.84px;
}

.carousel img {
  width: 100%;
  box-sizing: border-box;
  padding: 0 40px; 
  opacity: 0.9; 
}

.carousel img:not(:first-of-type) {
  position: absolute;
  left: 0;
  top: 0;
  transform-origin: 50% 50% -482.84px;
}


/* Rotating images based on their positions */
.carousel img:nth-child(2) {
  transform: rotateY(1.256rad); 
}

.carousel img:nth-child(3) {
  transform: rotateY(2.512rad); 
}

.carousel img:nth-child(4) {
  transform: rotateY(3.768rad); 
}

.carousel img:nth-child(5) {
  transform: rotateY(5.024rad); 
}

</style>
